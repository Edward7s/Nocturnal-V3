using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Nocturnal;
using UnityEngine;
namespace Nocturnal.Exploits
{
    internal class Mirror
    {
        private static VRC.SDK3.Components.VRCMirrorReflection s_mirror { get; set; }
        private static GameObject s_mirrorGameObject { get; set; }
        private static VRC.SDK3.Components.VRCMirrorReflection[] s_mirrorsArr { get; set; }


        internal static void Togglemirror(bool valuem,bool isoptimized = false)
        {

            if (!valuem)
            {
                s_mirrorsArr = GameObject.FindObjectsOfType<VRC.SDK3.Components.VRCMirrorReflection>();
                for (int i = 0; i < s_mirrorsArr.Length; i++)
                    if (s_mirrorsArr[i].name == "NocturnalMirror")
                        GameObject.Destroy(s_mirrorsArr[i].gameObject);
                return;
            }

            try
            {
                s_mirrorGameObject = GameObject.CreatePrimitive(PrimitiveType.Quad);
                s_mirrorGameObject.name = "NocturnalMirror";
                s_mirrorGameObject.transform.position = VRC.Player.prop_Player_0.transform.position + VRC.Player.prop_Player_0.transform.forward;
                s_mirrorGameObject.GetComponent<MeshRenderer>().material = new Material(Shader.Find("FX/MirrorReflection"));
                s_mirror = s_mirrorGameObject.AddComponent<VRC.SDK3.Components.VRCMirrorReflection>();
                s_mirror.m_ReflectLayers = isoptimized ? 263680 : 263681;
                s_mirror.maximumAntialiasing = VRC.SDKBase.VRC_MirrorReflection.AntialiasingSamples.X1;
                s_mirror.TurnOffMirrorOcclusion = true;
                s_mirrorGameObject.AddComponent<Rigidbody>().isKinematic = true;
                s_mirrorGameObject.AddComponent<VRC.SDK3.Components.VRCPickup>().proximity = 1f;
                s_mirrorGameObject.transform.localEulerAngles = VRC.Player.prop_Player_0.transform.localEulerAngles                    ;
                s_mirrorGameObject.transform.localScale = new Vector3(5, 3.5f, 1);
                s_mirrorGameObject.layer = 13;
            }
            catch (Exception ex)
            {
                NocturnalC.Log(ex);
            }
          
        }

    }
}
