using System.Linq;
using UnityEngine;
using VRC.Core;
using VRC.SDKBase;
using VRC.UI;

namespace Nocturnal.Exploits
{
    internal class Misc
    {
        private static Renderer[] _Render { get; set; }
        internal static void Deletportals()
        {
            var array = Resources.FindObjectsOfTypeAll<PortalTrigger>();
            for (int i = 0; i < array.Length; i++)
                if (array[i].gameObject.active)
                    GameObject.DestroyImmediate(array[i].gameObject);
        }

        internal static void Changetoavi(string aviid)
        {
            Ui.Objects._AvatarPage.field_Public_SimpleAvatarPedestal_0.field_Internal_ApiAvatar_0 = new ApiAvatar
            {
                id = aviid,
            };
            Ui.Objects._AvatarPage.ChangeToSelectedAvatar();
        }

        internal static void Outlineobjectandchilds(GameObject obj, Color colora, bool onoff = true)
        {
            try
            {
                _Render = obj.GetComponentsInChildren<Renderer>(true);
                if (onoff)
                {              
                    var outm = new Material(Ui.Bundles.outlshader);
                    outm.EnableKeyword("_falloff");
                    outm.SetFloat("_falloff", 0);
                    outm.EnableKeyword("_Color");
                    outm.SetColor("_Color", colora);
                    outm.EnableKeyword("width");
                    outm.SetFloat("_Width", 0.6f);
                    outm.name = "espshaderNocturnal";
                    for (int i = 0; i < _Render.Length; i++)
                    {
                        var materials = _Render[i].sharedMaterials.ToList();
                        materials.Add(outm);
                        _Render[i].materials = materials.ToArray();
                        _Render[i].allowOcclusionWhenDynamic = false;

                    }
                }
                else
                {
                    for (int i = 0; i < _Render.Length; i++)
                    {
                        var materials = _Render[i].sharedMaterials.ToList();
                        for (int i2 = 0; i2 < materials.Count; i2++)
                        {
                            if (materials[i2].name == "espshaderNocturnal")
                                materials.Remove(materials[i2]);
                        }
                        _Render[i].materials = materials.ToArray();
                        _Render[i].allowOcclusionWhenDynamic = true;
                    }
                }
            }
            catch { }
          
        }

            internal static void Jump(float multipliead = 1)
        {
            Vector3 velocity = Networking.LocalPlayer.GetVelocity();
            velocity.y = Networking.LocalPlayer.GetJumpImpulse() * multipliead;
            Networking.LocalPlayer.SetVelocity(velocity);
        }
    }
}
